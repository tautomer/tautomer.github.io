---
layout: post
title: Predicting "protein-protein interactions" with neural networks
description: Use a convolutional neural network to predict if a pairs of proteins interact with each other, part 1.
tags:
- Machine Learning
- Neural Network
- Coding
- Python
- Torch
---

<section>
 <section>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <h1 id="Predicting-%22protein-protein-interactions%22-with-neural-networks">
       Predicting "protein-protein interactions" with neural networks
       <a class="anchor-link" href="#Predicting-%22protein-protein-interactions%22-with-neural-networks"><i class="fa-solid fa-sm fa-link"></i></a>
      </h1>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <h1 id="Part-1:-parsing-data">
       Part 1: parsing data
       <a class="anchor-link" href="#Part-1:-parsing-data"><i class="fa-solid fa-sm fa-link"></i></a>
      </h1>
      <p>Well, I recently review a manuscript on predicting the so-called
"protein-protein interactions" with a convolutional neural network (CNN). The
quality of the paper was exceptionally low, the authors are from different
institutions that they are really unlikely to collaborate with each other. It is
highly likely that the paper was from a <a href="https://spie.org/news/photonics-focus/julyaugust-2023/investigating-publication-fraud#_=_">paper mill</a>. Nonetheless,
as I have never done formal research on biological system, the draft still
helped to me know something in the field. I was really curious on the validity
of their results and if I could achieve better predictions, so here it is.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <h3 id="What-are-they-doing-here">
       What are they doing here
       <a class="anchor-link" href="#What-are-they-doing-here"><i class="fa-solid fa-sm fa-link"></i></a>
      </h3>
      <p>They are basically doing a sequence based binary classification. Some protein
pairs are divided into two categories, interacting paris and non-interacting
pairs. As far as I understand, "interacting" means the two proteins can bind
with each other, while "non-interacting" ones will repulse each other (if they
are close enough).</p>
      <p>This problem sounds really trivial to me. You just have to process two strings
(one-letter amino acid sequence of a protein is just a string) and classify them
in two two group. I felt I should be able to get it done pretty quickly, so I
started looking into it.</p>
      <p>I have attached the original notebook to this site and can be downloaded
<a href="/assets/codes/ppi.ipynb">here</a>, so you can play with it yourself.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <h3 id="The-dataset">
       The dataset
       <a class="anchor-link" href="#The-dataset"><i class="fa-solid fa-sm fa-link"></i></a>
      </h3>
      <p>They were dealing with several datasets from different sources, but focused on
one dataset published by <a href="http://www.csbio.sjtu.edu.cn/bioinf/LR_PPI/Data.htm">a group from SJTU</a>.</p>
      <p><img alt="Datasets" src="../../assets/images/ml/ppi/sjtu.png"/></p>
      <p>The two files used are supporting information A and B, for interacting and
non-interacting pairs, respectively. As the names suggest, these files are SI
for a certain paper. However, I have no idea who decided a MS Word document
could be a good choice in this case.</p>
      <p>The two files consist of a header</p>
      <div class="highlight">
       <pre><span></span>Online support information A
There are 36,630 protein-protein pairs from total 9476 proteins, and the first column is protein ID from HPRD, the second column is the other protein ID and the two proteins constitute the positive Protein-protein interaction.

Index        Protein_1_ID         protein_2_ID
</pre>
      </div>
      <p>and blocks like the following</p>
      <div class="highlight">
       <pre><span></span>1 NP_663777.1  NP_001233.1
&gt;NP_663777.1
MESSKKMDSPGALQTNPPLKLHTDRSAGTPVFVPEQGGYKEKFVKTVEDKYKCEKCHLVLCSPKQTECGHRFCESCMAALLSSSSPKCTACQESIVKDKVFKDNCCKREILALQIYCRNESRGCAEQLMLGHLLVHLKNDCHFEELPCVRPDCKEKVLRKDLRDHVEKACKYREATCSHCKSQVPMIALQKHEDTDCPCVVVSCPHKCSVQTLLRSELSAHLSECVNAPSTCSFKRYGCVFQGTNQQIKAHEASSAVQHVNLLKEWSNSLEKKVSLLQNESVEKNKSIQSLHNQICSFEIEIERQKEMLRNNESKILHLQRVIDSQAEKLKELDKEIRPFRQNWEEADSMKSSVESLQNRVTELESVDKSAGQVARNTGLLESQLSRHDQMLSVHDIRLADMDLRFQVLETASYNGVLIWKIRDYKRRKQEAVMGKTLSLYSQPFYTGYFGYKMCARVYLNGDGMGKGTHLSLFFVIMRGEYDALLPWPFKQKVTLMLMDQGSSRRHLGDAFKPDPNSSSFKKPTGEMNIASGCPVFVAQTVLENGTYIKDDTIFIKVIVDTSDLPDP
&gt;NP_001233.1
MARPHPWWLCVLGTLVGLSATPAPKSCPERHYWAQGKLCCQMCEPGTFLVKDCDQHRKAAQCDPCIPGVSFSPDHHTRPHCESCRHCNSGLLVRNCTITANAECACRNGWQCRDKECTECDPLPNPSLTARSSQALSPHPQPTHLPYVSEMLEARTAGHMQTLADFRQLPARTLSTHWPPQRSLCSSDFIRILVIFSGMFLVFTLAGALFLHQRRKYRSNKGESPVEPAEPCRYSCPREEEGSTIPIQEDYRKPEPACSP
</pre>
      </div>
      <p>In side each block, the first line is the index for the pair, and their
<a href="refseq">RefSeq</a> IDs. Then the next line will start with a <code>&gt;</code> symbol and
followed by the RefSeq ID of the first protein. The next line is the amino acid
sequence of the protein in the one letter code. Similarly, the next 2 lines are
for protein 2.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <h3 id="Process-the-Word-documents">
       Process the Word documents
       <a class="anchor-link" href="#Process-the-Word-documents"><i class="fa-solid fa-sm fa-link"></i></a>
      </h3>
      <p>Now I need find a programming way to deal with these two files. There are some
Python packages for parsing MS Word documents, but I did not have good luck with
it, possibly because these files are in the Word 2003 format.</p>
      <p>After some googling, I decided to give <a href="https://linux.die.net/man/1/antiword">antiword</a> a shot. You can
easily install it via the package manager from your OS.</p>
      <div class="highlight">
       <pre><span></span><span class="c1"># download the MS Word file</span>
wget<span class="w"> </span>http://www.csbio.sjtu.edu.cn/bioinf/LR_PPI/Supp-A.doc
<span class="c1"># well, I use debian and ubuntu anyway...</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>antiword
<span class="c1"># convert!</span>
antiword<span class="w"> </span>Supp-A.doc<span class="w"> </span>&gt;<span class="w"> </span>Supp-A.txt
</pre>
      </div>
      <p>A very smooth process. It worked like a charm. The resulting <code>Supp-A.txt</code> is
just a plaintext version of the Word document. The only difference is that the
soft wrap in the Word document is now a hard wrap, meaning that the super long
sequences will be break into multiple lines. This makes parsing the file a
little bit more tedious. Before, you know that the sequence is always stored in
one line.</p>
      <div class="highlight">
       <pre><span></span>Online support information A
There are 36,630 protein-protein pairs from total 9476 proteins, and the
first column is protein ID from HPRD, the second column is the other
protein ID and the two proteins constitute the positive Protein-protein
interaction.

Index        Protein_1_ID         protein_2_ID
1 NP_663777.1  NP_001233.1
&gt;NP_663777.1
MESSKKMDSPGALQTNPPLKLHTDRSAGTPVFVPEQGGYKEKFVKTVEDKYKCEKCHLVLCSPKQTECGHRFCESC
MAALLSSSSPKCTACQESIVKDKVFKDNCCKREILALQIYCRNESRGCAEQLMLGHLLVHLKNDCHFEELPCVRPD
CKEKVLRKDLRDHVEKACKYREATCSHCKSQVPMIALQKHEDTDCPCVVVSCPHKCSVQTLLRSELSAHLSECVNA
PSTCSFKRYGCVFQGTNQQIKAHEASSAVQHVNLLKEWSNSLEKKVSLLQNESVEKNKSIQSLHNQICSFEIEIER
QKEMLRNNESKILHLQRVIDSQAEKLKELDKEIRPFRQNWEEADSMKSSVESLQNRVTELESVDKSAGQVARNTGL
LESQLSRHDQMLSVHDIRLADMDLRFQVLETASYNGVLIWKIRDYKRRKQEAVMGKTLSLYSQPFYTGYFGYKMCA
RVYLNGDGMGKGTHLSLFFVIMRGEYDALLPWPFKQKVTLMLMDQGSSRRHLGDAFKPDPNSSSFKKPTGEMNIAS
GCPVFVAQTVLENGTYIKDDTIFIKVIVDTSDLPDP
&gt;NP_001233.1
MARPHPWWLCVLGTLVGLSATPAPKSCPERHYWAQGKLCCQMCEPGTFLVKDCDQHRKAAQCDPCIPGVSFSPDHH
TRPHCESCRHCNSGLLVRNCTITANAECACRNGWQCRDKECTECDPLPNPSLTARSSQALSPHPQPTHLPYVSEML
EARTAGHMQTLADFRQLPARTLSTHWPPQRSLCSSDFIRILVIFSGMFLVFTLAGALFLHQRRKYRSNKGESPVEP
AEPCRYSCPREEEGSTIPIQEDYRKPEPACSP
</pre>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Anyway, once we have a plaintext file, reading it is always easy. After some
tweaking, I came up with this way of reading the file.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Let us load necessary packages first.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [1]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span><span class="p">,</span> <span class="n">random_split</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [2]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="k">def</span> <span class="nf">read_sequence</span><span class="p">():</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="n">digits</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Supp-A.txt"</span><span class="p">,</span> <span class="s2">"Supp-B.txt"</span><span class="p">]</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">skip_lines</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">proteins</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">interactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">eof</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">doc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">skip_lines</span><span class="p">[</span><span class="n">_</span><span class="p">]):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
                <span class="c1"># "&gt;ID1" line</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
                    <span class="c1"># read sequence for the first protein</span>
                    <span class="n">sequence</span> <span class="o">=</span> <span class="s2">""</span>
                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                        <span class="c1"># break when 1. "&gt;ID2" or next pair or EOF is read</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"&gt;"</span> <span class="ow">or</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">:</span>
                                <span class="n">proteins</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                                <span class="n">eof</span><span class="o">=</span><span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"&gt;"</span><span class="p">:</span>
                                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">break</span>
                        <span class="n">sequence</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                    <span class="c1"># print(count, id, sequence)</span>
                    <span class="k">if</span> <span class="n">eof</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">eof</span><span class="p">:</span>
                    <span class="n">interactions</span> <span class="o">+=</span> <span class="p">[</span><span class="n">types</span><span class="p">[</span><span class="n">_</span><span class="p">]]</span> <span class="o">*</span> <span class="n">count</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">proteins</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">interactions</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [3]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">proteins</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">interactions</span> <span class="o">=</span> <span class="n">read_sequence</span><span class="p">()</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
    </div>
    <div class="jp-OutputArea jp-Cell-outputArea">
     <div class="jp-OutputArea-child">
      <div class="jp-OutputPrompt jp-OutputArea-prompt">
      </div>
      <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
       <pre>Supp-A.txt
Supp-B.txt
</pre>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>It is a little tricky to make a script to read the script fully automatically. I
guess I will add some comments over here later. The resulting sequences need to
be further processed before we can use them.</p>
      <p>One common thing people in this field do is to exclude all sequences below 50
amino acids and remove all sequences with non-canonical amino acids, for
example, in <a href="https://pubmed.ncbi.nlm.nih.gov/31029609/">this paper</a>.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [4]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="c1"># use the dictionary `to_remove` to store any protein ID that follows in the two criteria above</span>
<span class="n">to_remove</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">proteins</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">to_remove</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="k">continue</span>
    <span class="c1"># I have checked the sequences, the only "non-canonical" is "U" which is selenocysteine</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">:</span>
            <span class="n">to_remove</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Then if the keys in <code>to_remove</code> show up in any pair, we remove the pair and
their interaction value from the lists.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [5]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">id1</span> <span class="ow">in</span> <span class="n">to_remove</span> <span class="ow">or</span> <span class="n">id2</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">pairs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interactions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">proteins</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Then I would like to save the processed data as csv files, though I never use
them really...</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [6]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">ppi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)):</span>
    <span class="n">ppi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"protein 1"</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"protein 2"</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"interaction"</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
<span class="n">protein_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">proteins</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">protein_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"sequence"</span><span class="p">]</span>
<span class="n">interaction_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ppi</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">protein_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"proteins.csv"</span><span class="p">)</span>
<span class="n">interaction_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"ppi.csv"</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Next, I would like to find a percentile to truncate long sequences. The reason
to do it is that vast majority of the sequences are very short (a few hundred),
but there are some very long outliers (for example, &gt; 30K). If you allocate a
tensor based on the longest sequence, the drawback is obvious. The tensor will
be very sparse. As a result, it is wise to cut these long sequences.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Loop through all sequences and get the length of the sequence at 95% percentile.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [7]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">seq_len</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">proteins</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">seq_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">seq_len</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Next, convert the strings of all sequences to a tensor of integers based on ASC
II. Note that here we have the tensor of sequences, not pairs yet.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [8]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">sequences</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">proteins</span><span class="p">),</span> <span class="n">length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">proteins</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">sequences</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="mi">64</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Then we can build the tensors for the pairs. <code>protein1</code> and <code>protein2</code> are the
sequences of the first and second proteins in each pair. <code>targets</code> is the tensor
of labels for whether the pair is interacting or not. I am doing a manual
one-hot encoder here. Of course you can ask <code>torch</code> to do it. Not sure why I
wanted to do it manually.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>Here I build another helper dictionary called <code>protein_idx</code> just to quickly
locate the index of each protein in <code>sequences</code>. ($O(1)$ for a hashtable and
$O(n)$ for a list)</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [9]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">protein_idx</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">proteins</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">protein_idx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [10]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">interactions</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">protein1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">interactions</span><span class="p">),</span> <span class="n">length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="n">protein2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">interactions</span><span class="p">),</span> <span class="n">length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)):</span>
    <span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">protein1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">protein_idx</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
    <span class="n">protein2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">protein_idx</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>We have got all the tensors we need, so we can easily assemble a dataset with
torch's <code>TensorDataset</code> class.</p>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
      In [11]:
     </div>
     <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="cm-editor cm-s-jupyter">
       <div class="highlight hl-ipython3">
        <pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">protein1</span><span class="p">,</span> <span class="n">protein2</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
   <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
    </div>
    <div class="jp-InputArea jp-Cell-inputArea">
     <div class="jp-InputPrompt jp-InputArea-prompt">
     </div>
     <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
      <p>After this, we will start to build our network. Please check out the section
part of this post over <a href="/posts/protein_protein_interaction_p2/">here</a>.</p>
     </div>
    </div>
   </div>
  </div>
 </section>
</section>
